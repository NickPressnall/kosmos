#!/usr/bin/env ruby

require 'kosmos'

Kosmos.configure do |config|
  config.verbose = true
end

case ARGV.shift
when 'init'
  ksp_path = ARGV.shift

  puts "Initializing Kosmos into #{ksp_path} (This will take a sec) ..."

  Kosmos::Versioner.init_repo(ksp_path)
  Kosmos.save_ksp_path(ksp_path)

  puts "Done! You're ready to begin installing mods."
  puts
  puts "Install your first mod by running the command:"
  puts "  kosmos install [name-of-the-mod]"
  puts

when 'install'
  ksp_path = Kosmos.load_ksp_path

  ARGV.each do |package_name|
    package = Kosmos::Package.find(package_name)

    if Kosmos::Versioner.installed_packages(ksp_path).include?(package.title)
      puts "Error: You have already installed #{package.title} with Kosmos."
      exit
    end

    if package
      puts "Installing package #{package.title} ..."
      package.new.install!(ksp_path)
      puts "Done!"
    else
      puts "Error: Kosmos couldn't find any packages with the name #{package_name.inspect}."
      exit
    end
  end

when 'uninstall'
  ksp_path = Kosmos.load_ksp_path

  package_name = ARGV.shift
  package = Kosmos::Package.find(package_name)

  if package
    puts "Preparing to uninstall #{package.title} ..."
    Kosmos::Versioner.uninstall_package(ksp_path, package)
    puts "Done! Just uninstalled: #{package.title}."
  else
    puts "Error: Kosmos couldn't find any packages with the name #{package_name.inspect}."
  end

when 'list'
  ksp_path = Kosmos.load_ksp_path

  packages = Kosmos::Versioner.installed_packages(ksp_path)
  puts "You have installed #{packages.length} mod(s) using Kosmos:"

  packages.each do |package|
    puts "  * #{package}"
  end
end
